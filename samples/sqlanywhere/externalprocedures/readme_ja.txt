// ***************************************************************************
// Copyright (c) 2013 SAP AG or an SAP affiliate company. All rights reserved.
// ***************************************************************************
// サンプルコードは「現状有姿(as is)」の条件で提供されるものであり、
// お客様に対しいかなる保証責任も賠償責任も負わないものとします。
//
// お客様は、当該サンプルコードを使用、複製および配布することができます。
// ただし、アイエニウェアの原コードに関する著作権表示およびにこれに対する
// 免責表示をすることを条件とします。
// 
// *********************************************************************

		    外部ストアドプロシージャーのサンプル

目的
----
このフォルダーには、SQL Anywhere を使用して SQL から呼び出すことがで
きる DLL で定義された外部ストアドプロシージャーのサンプルがいくつか含
まれています。
DLL のソースコードは、extproc. に含まれています。

必要条件
--------
このサンプルは、以下を前提としています。
 - 環境変数 SQLANY16 に SA フォルダーが設定されている。
   これは、SQL Anywhere のインストール時に設定されます。
Windows の場合、さらに以下も前提としています。
 - makefile を使用するために、Visual Studio .NET 2003 または 
   Visual Studio 2005 がインストール済みである。
 - 環境変数 VCINSTALLDIR が設定済みである。これは、Visual Studio の
   インストール時に設定されますが、Visual Studio によってインストールされる 
   vcvars32.bat ファイルを使用して設定することもできます。

ソースコードは、他のコンパイラでもコンパイルできます。

UNIX 専用のビルド手順については、build.sh ファイルを参照してください。

処理手順
--------
build.bat (Windows の場合) または build.sh (UNIX の場合) を実行すると、
DLL (UNIX は共有オブジェクト) をコンパイルします。

show_exports.bat (Windows の場合) または show_exports.sh (UNIX の場合) 
を実行すると、エクスポートされたシンボルを表示します。

DLL (共有オブジェクト) をパス内のフォルダー (Windows の場合) または
ライブラリパス (UNIX の場合) にコピーします。

任意のデータベースでデータベースサーバーを開始します。

DBISQL を起動し、データベースに接続します。

DBISQL で、以下のコマンドを実行します。
    read extproc.sql
ストアドプロシージャーが定義されます。

DBISQL で、以下のコマンドを実行します。
    read tests.sql
プロシージャーが呼び出されます。結果ペインに結果が表示されます。

clean.bat を実行することにより、生成されたすべてのファイルを削除するこ
とができます。


外部プロシージャーのデバッグ
--------------------------

以下の手順は、Microsoft Development Environment 2005 を使用して Windows 
環境でデバッグを行うことを前提としています。

 - データベースサーバーが外部プロシージャー DLL を使用していないことを確
   認するために、データベースサーバーを停止します。
 - makefile を編集し、DebugOptions を以下のように変更します。
    DebugOptions=/Od /Zi
 - clean.bat を実行します。
 - build.bat を実行します。
 - 以下のコマンドを使用して、データベースサーバーを起動します。
   devenv /debugexe <SA-bin-dir>\dbeng16.exe <full path to database>
 - Visual Studio が起動したら、[ファイル] ‐ [開く] を使用して 
   extproc.cpp ファイルを探します。extproc.cpp をダブルクリックしてファ
   イルを開きます。
 - デバッグする関数にブレークポイントを設定します。
 - [F5] を押してデータベースサーバーの実行を開始します。データベース
   サーバー用のデバッグ情報がないという通知が表示されます。[OK] をク
   リックして続行します。
 - DBISQL を起動し、デバッグするストアドプロシージャーへの呼び出しを実行
   します。ブレークポイントがヒットします。
  
